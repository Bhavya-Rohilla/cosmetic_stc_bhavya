<style>
  .countdown-section {
    text-align: center;
    background: #ff4d00;
    color: white;
    font-size: 20px;
    font-weight: bold;
    padding: 10px;
    border-radius: 5px;
    margin-top: 10px;
  }

  #countdown-timer {
    font-weight: bold;
    color: yellow;
  }

  /* Popup Styles */
  .popup {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
  }

  .popup-content {
    background: white;
    padding: 20px;
    text-align: center;
    border-radius: 10px;
  }

  .popup button {
    background: #ff4d00;
    color: white;
    border: none;
    padding: 10px;
    cursor: pointer;
  }
</style>


<!-- Countdown Timer Section -->
<div class="countdown-section">
  <p>Time Left: <span id="countdown-timer"></span></p>
</div>

<!-- Hidden Popup -->
<div id="hooray-popup" class="popup">
  <div class="popup-content">
    <h2>ðŸŽ‰ Hooray! ðŸŽ‰</h2>
    <p id="random-text"></p>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<!-- Store countdown value from Shopify settings -->
<div id="countdown-data" data-time="{{ section.settings.countdown_minutes | times: 60 }}"></div>



<script>
 document.addEventListener("DOMContentLoaded", function () {
    let countdownMinutes = 20; // Set this dynamically from Liquid
    let now = Math.floor(Date.now() / 1000); // Current time in seconds

    let storedEndTime = localStorage.getItem("countdown_end");

    if (!storedEndTime || storedEndTime < now) {
        localStorage.setItem("countdown_end", now + countdownMinutes * 60);
        storedEndTime = now + countdownMinutes * 60;
    }

    function updateCountdown() {
        let remainingTime = storedEndTime - Math.floor(Date.now() / 1000);
        let minutes = Math.floor(remainingTime / 60);
        let seconds = remainingTime % 60;

        document.getElementById("countdown-timer").textContent = 
            minutes + "m " + (seconds < 10 ? "0" : "") + seconds + "s";

        if (remainingTime > 0) {
            setTimeout(updateCountdown, 1000);
        } else {
            document.getElementById("countdown-timer").textContent = "Time's Up!";
            showPopup();
        }
    }

    updateCountdown();
});

</script>

{% schema %}
{
  "name": "Countdown Timer",
  "tag": "section",
  "class": "countdown-timer",
  "settings": [
    {
      "type": "range",
      "id": "countdown_minutes",
      "label": "Countdown Duration (Minutes)",
      "min": 1,
      "max": 60,
      "step": 1,
      "default": 5
    }
  ],
  "presets": [
    {
      "name": "Countdown Timer"
    }
  ]
}
{% endschema %}
